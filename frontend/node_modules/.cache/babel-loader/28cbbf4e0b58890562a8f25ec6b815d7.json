{"ast":null,"code":"var _jsxFileName = \"/Users/wen/Desktop/Projects/React/travelPlanner/client/src/Pages/itinerary.js\";\nimport React, { useState, useContext } from 'react';\nimport { DragDropContext } from 'react-beautiful-dnd';\nimport { useQuery, useMutation } from '@apollo/react-hooks';\nimport gql from 'graphql-tag';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { Button, IconButton } from '@material-ui/core/';\nimport SaveIcon from '@material-ui/icons/Save';\nimport AddCircleOutlineRoundedIcon from '@material-ui/icons/AddCircleOutlineRounded';\nimport DayBoard from '../Components/dayBoard';\nimport CategoryBoard from '../Components/categoryBoard';\nimport Form from '../Components/form';\nimport PlaceAutoComplete from '../Components/placeAutoComplete';\nimport { fetchCategories, fetchPlaceIds } from '../Services/googlePlaceApi';\nimport { PlaceContext } from '../Store/PlaceContext';\nconst useStyles = makeStyles({\n  buttonDiv: {\n    display: \"flex\",\n    justifyContent: \"flex-end\"\n  },\n  saveButton: {\n    height: 53\n  },\n  addButton: {\n    \"&:hover\": {\n      backgroundColor: \"transparent\"\n    }\n  }\n});\n\nfunction Itinerary(props) {\n  const {\n    placeState,\n    dispatch\n  } = useContext(PlaceContext);\n  const [itineraryId, setItineraryId] = useState(props.match.params.itineraryId ? props.match.params.itineraryId : \"\");\n  const [saveError, setSaveError] = useState(\"\");\n  const classes = useStyles();\n  /* Causes infinite loop LOL\n  if (props.match.params.itineraryId) {\n      console.log('it is from the link');\n      setItineraryId(props.match.params.itineraryId);\n  };\n  */\n\n  async function fetchItineraryFromGoogle(data) {\n    dispatch({\n      type: \"CLEAR_STATE\"\n    });\n    const city = data.getItinerary.city;\n    const dayPlans = data.getItinerary.dayPlans;\n    dispatch({\n      type: \"LOAD_EMPTY_DAYS\",\n      payload: {\n        numberOfDays: dayPlans.length,\n        city\n      }\n    });\n    fetchPlaceIds(dayPlans);\n    const placeTypes = ['Restaurants', \"Hotels\", \"Tourist+attraction\"];\n    fetchCategories(placeTypes, city, dispatch);\n  } // unnecessary if you don't need to access 'data' else where\n  // const { data } = \n\n\n  useQuery(GET_ITINERARY, {\n    // just doen't seem to work\n    // skip: itineraryId !== placeState.itineraryId,\n    onCompleted(data) {\n      // does not run when the component was not remounted and parameter in query does not change\n      if (itineraryId !== placeState.itineraryId) {\n        fetchItineraryFromGoogle(data);\n      }\n    },\n\n    variables: {\n      itineraryId\n    }\n  });\n  /* Tracking Changes in Data\n  While data is from useQuery, it is tagged to an id; and when you update the document via useMutation, this data changes! Even though the 'data' variable is not from there.\n  \n  useEffect(() => {\n      if(data){\n          fetchItineraryFromGoogle();\n      }\n  }, [data])\n  */\n\n  const onDragEnd = result => {\n    const {\n      destination,\n      source,\n      draggableId\n    } = result;\n\n    if (!destination) {\n      return;\n    }\n\n    if (destination.droppableId === source.droppableId && destination.index === source.index) {\n      return;\n    }\n\n    const start = placeState.columns[source.droppableId];\n    const finish = placeState.columns[destination.droppableId]; //if moving within the same column\n\n    if (start === finish) {\n      const column = placeState.columns[source.droppableId];\n      const newplaceIds = Array.from(column.placeIds);\n      newplaceIds.splice(source.index, 1);\n      newplaceIds.splice(destination.index, 0, draggableId);\n      const newColumn = { ...column,\n        placeIds: newplaceIds\n      };\n      const newOrder = { ...placeState,\n        columns: { ...placeState.columns,\n          [newColumn.id]: newColumn\n        }\n      };\n      console.log(newOrder);\n      dispatch({\n        type: 'CHANGE_ORDER',\n        order: {\n          newOrder\n        }\n      });\n      return;\n    } //moving from one list to another\n\n\n    const startplaceIds = Array.from(start.placeIds);\n    startplaceIds.splice(source.index, 1);\n    const newStart = { ...start,\n      placeIds: startplaceIds\n    };\n    const finishplaceIds = Array.from(finish.placeIds);\n    finishplaceIds.splice(destination.index, 0, draggableId);\n    const newFinish = { ...finish,\n      placeIds: finishplaceIds\n    };\n    const newOrder = { ...placeState,\n      columns: { ...placeState.columns,\n        [newStart.id]: newStart,\n        [newFinish.id]: newFinish\n      }\n    };\n    console.log(newOrder);\n    dispatch({\n      type: 'CHANGE_ORDER',\n      order: {\n        newOrder\n      }\n    });\n  };\n\n  let itinerary = [];\n  const mutation = itineraryId ? SAVE_ITINERARY : SUBMIT_ITINERARY;\n  const [submitItinerary] = useMutation(mutation, {\n    // 'result' is the second parameter!\n    update(_, result) {\n      console.log(result.data);\n\n      if (!itineraryId) {\n        setItineraryId(result.data.submitItinerary.id);\n      }\n\n      setSaveError(\"\");\n    },\n\n    onError(err) {\n      setSaveError(err.graphQLErrors[0].extensions.exception.stacktrace[0]);\n    },\n\n    variables: {\n      dayPlans: itinerary,\n      city: placeState.location,\n      id: itineraryId\n    }\n  });\n\n  const addExtraDay = () => {\n    dispatch({\n      type: 'ADD_EXTRA_DAY'\n    });\n  };\n\n  const saveItinerary = () => {\n    const days = placeState.dayBoards;\n\n    for (var i = 0; i < days.length; i++) {\n      itinerary.push({\n        placeIds: placeState.columns[days[i]].placeIds\n      });\n    } //console.log(itinerary);\n\n\n    submitItinerary();\n  };\n\n  console.log(placeState);\n  return React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201\n    },\n    __self: this\n  }, React.createElement(Form, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202\n    },\n    __self: this\n  }), itineraryId !== placeState.itineraryId ? React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203\n    },\n    __self: this\n  }, \"Loading\") : \"\", placeState.days !== 0 ? React.createElement(DragDropContext, {\n    onDragEnd: onDragEnd,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"day-and-search\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206\n    },\n    __self: this\n  }, React.createElement(PlaceAutoComplete, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"day-boards-container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209\n    },\n    __self: this\n  }, placeState.dayBoards.map(columnId => {\n    const column = placeState.columns[columnId];\n    const places = column.placeIds.map(placeId => placeState.places[placeId]);\n    return React.createElement(DayBoard, {\n      key: column.id,\n      column: column,\n      places: places,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216\n      },\n      __self: this\n    });\n  }), placeState.dayBoards.length > 0 ? React.createElement(IconButton, {\n    className: classes.addButton,\n    disableRipple: true,\n    disableFocusRipple: true,\n    onClick: addExtraDay,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219\n    },\n    __self: this\n  }, React.createElement(AddCircleOutlineRoundedIcon, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224\n    },\n    __self: this\n  })) : \"\")), React.createElement(\"div\", {\n    className: classes.buttonDiv,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229\n    },\n    __self: this\n  }, React.createElement(Button, {\n    className: classes.saveButton,\n    variant: \"outlined\",\n    size: \"medium\",\n    onClick: saveItinerary,\n    startIcon: React.createElement(SaveIcon, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235\n      },\n      __self: this\n    }),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230\n    },\n    __self: this\n  }, \"Save Itinerary\")), saveError ? React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240\n    },\n    __self: this\n  }, saveError) : \"\", placeState.categoryBoards.length > 0 ? React.createElement(\"div\", {\n    className: \"place-boards-container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242\n    },\n    __self: this\n  }, placeState.categoryBoards.map(columnId => {\n    const column = placeState.columns[columnId];\n    const places = column.placeIds.map(placeId => placeState.places[placeId]);\n    return React.createElement(CategoryBoard, {\n      key: column.id,\n      column: column,\n      places: places,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248\n      },\n      __self: this\n    });\n  })) : null) : \"\");\n}\n\nconst SUBMIT_ITINERARY = gql`\n    mutation submitItinerary(\n        $dayPlans: [DayPlanInput]!\n        $city: String!\n    ){\n        submitItinerary(\n            dayPlans: $dayPlans\n            city: $city\n        ){\n            id\n            city\n            dayPlans{\n                placeIds\n            }\n            createdAt\n            user\n            username\n        }\n    }\n`;\nconst SAVE_ITINERARY = gql`\n    mutation saveItinerary(\n        $id: ID!\n        $dayPlans: [DayPlanInput]!\n    ){\n        saveItinerary(\n            dayPlans: $dayPlans\n            id: $id\n        ){\n            id\n            city\n            dayPlans{\n                placeIds\n            }\n            createdAt\n            user\n            username\n        }\n    }\n`;\nconst GET_ITINERARY = gql`\n    query getItinerary(\n        $itineraryId: ID!\n    ){\n        getItinerary(\n            itineraryId: $itineraryId\n        ){\n            id\n            city\n            dayPlans{\n                placeIds\n            }\n            createdAt\n            user\n            username \n        }\n    }\n`;\nexport default Itinerary;","map":{"version":3,"sources":["/Users/wen/Desktop/Projects/React/travelPlanner/client/src/Pages/itinerary.js"],"names":["React","useState","useContext","DragDropContext","useQuery","useMutation","gql","makeStyles","Button","IconButton","SaveIcon","AddCircleOutlineRoundedIcon","DayBoard","CategoryBoard","Form","PlaceAutoComplete","fetchCategories","fetchPlaceIds","PlaceContext","useStyles","buttonDiv","display","justifyContent","saveButton","height","addButton","backgroundColor","Itinerary","props","placeState","dispatch","itineraryId","setItineraryId","match","params","saveError","setSaveError","classes","fetchItineraryFromGoogle","data","type","city","getItinerary","dayPlans","payload","numberOfDays","length","placeTypes","GET_ITINERARY","onCompleted","variables","onDragEnd","result","destination","source","draggableId","droppableId","index","start","columns","finish","column","newplaceIds","Array","from","placeIds","splice","newColumn","newOrder","id","console","log","order","startplaceIds","newStart","finishplaceIds","newFinish","itinerary","mutation","SAVE_ITINERARY","SUBMIT_ITINERARY","submitItinerary","update","_","onError","err","graphQLErrors","extensions","exception","stacktrace","location","addExtraDay","saveItinerary","days","dayBoards","i","push","map","columnId","places","placeId","categoryBoards"],"mappings":"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","sourcesContent":["import React, { useState, useContext } from 'react';\nimport { DragDropContext } from 'react-beautiful-dnd';\nimport { useQuery, useMutation } from '@apollo/react-hooks';\nimport gql from 'graphql-tag';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport { Button, IconButton} from '@material-ui/core/';\nimport SaveIcon from '@material-ui/icons/Save';\nimport AddCircleOutlineRoundedIcon from '@material-ui/icons/AddCircleOutlineRounded';\n\nimport DayBoard from '../Components/dayBoard';\nimport CategoryBoard from '../Components/categoryBoard';\nimport Form from '../Components/form';\nimport PlaceAutoComplete from '../Components/placeAutoComplete'\nimport { fetchCategories, fetchPlaceIds } from '../Services/googlePlaceApi'\n\nimport { PlaceContext } from '../Store/PlaceContext';\n\n\nconst useStyles = makeStyles({\n    buttonDiv: {\n        display: \"flex\",\n        justifyContent: \"flex-end\",\n    },\n    saveButton: {\n        height: 53,\n    },\n    addButton: {\n        \"&:hover\": {\n            backgroundColor: \"transparent\"\n        },\n    },\n})\n\n\nfunction Itinerary(props) {\n\n    const { placeState, dispatch } = useContext(PlaceContext);\n    const [ itineraryId, setItineraryId ] = useState(props.match.params.itineraryId ? props.match.params.itineraryId : \"\");\n    const [ saveError, setSaveError ] = useState(\"\")\n\n    const classes = useStyles();\n    \n    /* Causes infinite loop LOL\n    if (props.match.params.itineraryId) {\n        console.log('it is from the link');\n        setItineraryId(props.match.params.itineraryId);\n    };\n    */\n\n    async function fetchItineraryFromGoogle(data) {\n\n        dispatch({type:\"CLEAR_STATE\"});\n\n        const city = data.getItinerary.city;\n        const dayPlans = data.getItinerary.dayPlans;\n        dispatch({ type:\"LOAD_EMPTY_DAYS\", payload:{numberOfDays: dayPlans.length, city}})\n\n        fetchPlaceIds(dayPlans);\n\n        const placeTypes = ['Restaurants', \"Hotels\", \"Tourist+attraction\"];\n        fetchCategories(placeTypes, city, dispatch);\n\n    }\n\n    // unnecessary if you don't need to access 'data' else where\n    // const { data } = \n    useQuery(GET_ITINERARY, {\n        // just doen't seem to work\n        // skip: itineraryId !== placeState.itineraryId,\n        onCompleted(data){\n            // does not run when the component was not remounted and parameter in query does not change\n            if (itineraryId !== placeState.itineraryId){\n                fetchItineraryFromGoogle(data);\n            }\n        },\n        variables: {itineraryId}\n    })\n\n    /* Tracking Changes in Data\n    While data is from useQuery, it is tagged to an id; and when you update the document via useMutation, this data changes! Even though the 'data' variable is not from there.\n    \n    useEffect(() => {\n        if(data){\n            fetchItineraryFromGoogle();\n        }\n    }, [data])\n    */\n\n    const onDragEnd = result => {\n        const { destination, source, draggableId } = result;\n\n        if (!destination) {\n            return;\n        }\n\n        if (\n            destination.droppableId === source.droppableId &&\n            destination.index === source.index\n        ) {\n            return;\n        }\n\n        const start = placeState.columns[source.droppableId];\n        const finish = placeState.columns[destination.droppableId];\n\n        //if moving within the same column\n        if (start === finish) {\n            const column = placeState.columns[source.droppableId];\n            const newplaceIds = Array.from(column.placeIds);\n            newplaceIds.splice(source.index, 1);\n            newplaceIds.splice(destination.index, 0, draggableId);\n\n            const newColumn = {\n                ...column,\n                placeIds: newplaceIds,\n            };\n\n            const newOrder = {\n                ...placeState,\n                columns: {\n                    ...placeState.columns,\n                    [newColumn.id]: newColumn,\n                },\n            };\n            console.log(newOrder);\n            dispatch({ type:'CHANGE_ORDER', order: {newOrder}});\n            return;\n        }\n\n        //moving from one list to another\n        const startplaceIds = Array.from(start.placeIds);\n        startplaceIds.splice(source.index, 1);\n        const newStart = {\n            ...start,\n            placeIds: startplaceIds,\n        };\n\n        const finishplaceIds = Array.from(finish.placeIds);\n        finishplaceIds.splice(destination.index, 0, draggableId);\n        const newFinish = {\n            ...finish,\n            placeIds: finishplaceIds,\n        };\n\n\n        const newOrder = {\n            ...placeState,\n            columns: {\n                ...placeState.columns,\n                [newStart.id]: newStart,\n                [newFinish.id]: newFinish,\n            },\n        };\n\n        console.log(newOrder);\n        dispatch({ type:'CHANGE_ORDER', order: {newOrder}});\n    };\n\n    let itinerary = [];\n    const mutation = itineraryId ? SAVE_ITINERARY : SUBMIT_ITINERARY;\n    const [submitItinerary] = useMutation(mutation, {\n        // 'result' is the second parameter!\n        update(_, result){\n            console.log(result.data);\n\n            if (!itineraryId) {\n                setItineraryId(result.data.submitItinerary.id)\n            }\n            setSaveError(\"\");\n        },\n        onError(err){\n            setSaveError(err.graphQLErrors[0].extensions.exception.stacktrace[0]);\n        },\n        variables: {\n            dayPlans: itinerary,\n            city: placeState.location,\n            id: itineraryId\n        }\n    })\n\n    const addExtraDay = () => {\n        dispatch({type:'ADD_EXTRA_DAY'});\n    }\n\n    const saveItinerary = () => {\n        const days = placeState.dayBoards;\n        for (var i = 0; i < days.length; i ++){\n            itinerary.push({\n                placeIds: placeState.columns[days[i]].placeIds\n            });\n            \n        }\n        //console.log(itinerary);\n        submitItinerary();\n    }\n\n    console.log(placeState);\n\n    return (\n        <div>\n            <Form/>\n            {itineraryId !== placeState.itineraryId ? <p>Loading</p> : \"\"}\n            {placeState.days !== 0 \n            ? <DragDropContext onDragEnd={onDragEnd}>\n                <div className='day-and-search'>\n                    <PlaceAutoComplete/>\n                    \n                    <div className='day-boards-container'>\n                        {placeState.dayBoards.map(columnId => {\n                            const column = placeState.columns[columnId];\n                            const places = column.placeIds.map(placeId => \n                                placeState.places[placeId]\n                            );\n\n                            return <DayBoard key={column.id} column={column} places={places}/>\n                        })}\n                        {placeState.dayBoards.length > 0 ?\n                            <IconButton \n                                className={classes.addButton}\n                                disableRipple={true}\n                                disableFocusRipple={true}\n                                onClick={addExtraDay}>\n                                <AddCircleOutlineRoundedIcon />\n                            </IconButton>\n                            : \"\"}\n                    </div>\n                </div>\n                <div className={classes.buttonDiv}>\n                    <Button \n                        className={classes.saveButton}\n                        variant=\"outlined\" \n                        size=\"medium\" \n                        onClick={saveItinerary}\n                        startIcon={<SaveIcon />}\n                    >\n                        Save Itinerary\n                    </Button>\n                </div>\n                {saveError ? <p>{saveError}</p> : \"\"}\n                {placeState.categoryBoards.length > 0 \n                ? <div className='place-boards-container'>\n                    {placeState.categoryBoards.map(columnId => {\n                        const column = placeState.columns[columnId];\n                        const places = column.placeIds.map(placeId => \n                            placeState.places[placeId]\n                        );\n                        return <CategoryBoard key={column.id} column={column} places={places}/>\n                    })}\n                </div>\n                : null}\n                \n            </DragDropContext>\n            : \"\"}\n        </div>\n        \n    );\n\n}\n\nconst SUBMIT_ITINERARY =  gql`\n    mutation submitItinerary(\n        $dayPlans: [DayPlanInput]!\n        $city: String!\n    ){\n        submitItinerary(\n            dayPlans: $dayPlans\n            city: $city\n        ){\n            id\n            city\n            dayPlans{\n                placeIds\n            }\n            createdAt\n            user\n            username\n        }\n    }\n`\n\nconst SAVE_ITINERARY = gql`\n    mutation saveItinerary(\n        $id: ID!\n        $dayPlans: [DayPlanInput]!\n    ){\n        saveItinerary(\n            dayPlans: $dayPlans\n            id: $id\n        ){\n            id\n            city\n            dayPlans{\n                placeIds\n            }\n            createdAt\n            user\n            username\n        }\n    }\n`\n\nconst GET_ITINERARY = gql`\n    query getItinerary(\n        $itineraryId: ID!\n    ){\n        getItinerary(\n            itineraryId: $itineraryId\n        ){\n            id\n            city\n            dayPlans{\n                placeIds\n            }\n            createdAt\n            user\n            username \n        }\n    }\n`\n\nexport default Itinerary;"]},"metadata":{},"sourceType":"module"}